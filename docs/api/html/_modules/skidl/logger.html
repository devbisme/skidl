

<!doctype html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>skidl.logger &#8212; SKiDL 2.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/bizstyle.css?v=a66e137f" />
    
    <script src="../../_static/documentation_options.js?v=20623aea"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <h1 id="site-title"><a href="../../../../"><img src="../../../../images/slim_banner.png" width="100%"></a></h1>
    
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SKiDL 2.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">skidl.logger</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for skidl.logger</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>

<span class="c1"># The MIT License (MIT) - Copyright (c) Dave Vandenbout.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Logging system for SKiDL.</span>

<span class="sd">This module provides logging functionality for runtime messages and electrical rule checking.</span>
<span class="sd">It includes specialized loggers that can output to both the console and log files,</span>
<span class="sd">with support for counting errors and warnings, and managing log file creation and deletion.</span>
<span class="sd">The module also provides context management for temporarily changing the active logger.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">.scriptinfo</span> <span class="kn">import</span> <span class="n">get_script_name</span><span class="p">,</span> <span class="n">get_skidl_trace</span>
<span class="kn">from</span> <span class="nn">.skidlbaseobj</span> <span class="kn">import</span> <span class="n">WARNING</span>
<span class="kn">from</span> <span class="nn">.utilities</span> <span class="kn">import</span> <span class="n">export_to_all</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rt_logger&quot;</span><span class="p">,</span> <span class="s2">&quot;erc_logger&quot;</span><span class="p">,</span> <span class="s2">&quot;active_logger&quot;</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">CountCalls</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator for counting the number of times a function is called.</span>
<span class="sd">    </span>
<span class="sd">    This decorator tracks calls to logging functions, making it easy</span>
<span class="sd">    to determine if and how many errors/warnings were issued during</span>
<span class="sd">    circuit processing or ERC.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        func (function): The function to be wrapped and counted.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call the wrapped function and increment the call counter.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            *args: Arguments to pass to the wrapped function.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the wrapped function.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            The return value from the wrapped function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the call counter to zero.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">class</span> <span class="nc">SkidlLogFileHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logger handler that outputs messages to a file with enhanced file handling.</span>
<span class="sd">    </span>
<span class="sd">    This extends the standard FileHandler with functionality to track</span>
<span class="sd">    filenames and remove log files when the handler is closed or removed.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        *args: Arguments to pass to FileHandler.</span>
<span class="sd">        **kwargs: Keyword arguments to pass to FileHandler.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Prevents future error when removing non-existent log file.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_log_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close and remove the log file associated with this handler.</span>
<span class="sd">        </span>
<span class="sd">        If the file doesn&#39;t exist or can&#39;t be removed, the filename is set to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
            <span class="c1"># Close file handle before removing file.</span>
            <span class="n">f_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">SkidlLogger</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">getLoggerClass</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    SKiDL logger with enhanced functionality for managing file output and context.</span>
<span class="sd">    </span>
<span class="sd">    This extends the standard Logger class with methods to manage file output handlers,</span>
<span class="sd">    control stack trace depth in messages, and provide better formatted error/warning messages.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        *args: Arguments to pass to Logger.</span>
<span class="sd">        **kwargs: Keyword arguments to pass to Logger.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_file_handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_trace_depth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a handler to the logger and track file handlers separately.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            handler (logging.Handler): The handler to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handler</span><span class="p">,</span> <span class="n">SkidlLogFileHandler</span><span class="p">):</span>
            <span class="c1"># Store handlers that output to files so they can be accessed later.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file_handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">removeHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a handler from the logger and clean up any associated log file.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            handler (logging.Handler): The handler to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file_handlers</span><span class="p">:</span>
            <span class="c1"># Remove log files when a log file handler is removed.</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">remove_log_file</span><span class="p">()</span>
            <span class="c1"># Remove handler from list of log file handlers.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_file_handlers</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop_file_output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop file output for all log handlers of this logger.</span>
<span class="sd">        </span>
<span class="sd">        This removes all file handlers, which in turn removes their log files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_file_handlers</span><span class="p">[:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_trace_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the depth of stack trace to include in log messages.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            depth (int): Number of stack frames to include in the trace.</span>
<span class="sd">                         0 means no trace information will be included.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace_depth</span> <span class="o">=</span> <span class="n">depth</span>

    <span class="k">def</span> <span class="nf">get_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a string containing the current trace information.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: A string with the call stack trace or empty string if trace_depth &lt;= 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_depth</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="n">trace</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">get_skidl_trace</span><span class="p">()]</span>
        <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace_depth</span>
        <span class="k">return</span> <span class="s2">&quot; @ [&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">trace</span><span class="p">[</span><span class="n">start</span><span class="p">:])</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>

    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a debug message with trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a summary message without location information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log an info message with trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bare_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log an info message without trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a warning message with trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bare_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a warning message without trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log an error message with trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bare_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log an error message without trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a critical message with trace information.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            msg (str): The message to log.</span>
<span class="sd">            *args: Arguments to pass to the logger.</span>
<span class="sd">            **kwargs: Keyword arguments to pass to the logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">raise_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_class</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log an error message and then raise an exception.</span>
<span class="sd">        </span>
<span class="sd">        This method combines logging an error and raising an exception</span>
<span class="sd">        to simplify error handling code.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            exc_class (Exception): The exception class to raise.</span>
<span class="sd">            msg (str): The error message to log and include in the exception.</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            exc_class: The specified exception with the given message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">exc_class</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">report_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phase_desc</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Report a summary of logged errors and warnings.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            phase_desc (str): Description of the phase being summarized (e.g., &quot;generating netlist&quot;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bare_error</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bare_warning</span><span class="o">.</span><span class="n">count</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No errors or warnings found while </span><span class="si">{</span><span class="n">phase_desc</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">active_logger</span><span class="o">.</span><span class="n">warning</span><span class="o">.</span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">active_logger</span><span class="o">.</span><span class="n">bare_warning</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2"> warnings found while </span><span class="si">{</span><span class="n">phase_desc</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">active_logger</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">active_logger</span><span class="o">.</span><span class="n">bare_error</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2"> errors found while </span><span class="si">{</span><span class="n">phase_desc</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>


<span class="k">class</span> <span class="nc">ActiveLogger</span><span class="p">(</span><span class="n">SkidlLogger</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Logger that manages the currently active logging context.</span>
<span class="sd">    </span>
<span class="sd">    This class encapsulates a stack of loggers and enables temporary</span>
<span class="sd">    switching between different logging contexts, with clean restoration</span>
<span class="sd">    of the previous context when done.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        logger (SkidlLogger): The initial logger to activate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the active logger with an initial logger.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            logger (SkidlLogger): The logger that will be active initially.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_loggers</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">LifoQueue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the active logger.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            logger (SkidlLogger): Logger to make active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_logger</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the currently active logger and activate a new one.</span>
<span class="sd">        </span>
<span class="sd">        This method puts the current logger on a stack and activates</span>
<span class="sd">        the provided logger in its place.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            logger (SkidlLogger): New logger to activate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_loggers</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_logger</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the previously active logger.</span>
<span class="sd">        </span>
<span class="sd">        This method deactivates the current logger and restores</span>
<span class="sd">        the logger that was active before the most recent push().</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prev_loggers</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">_create_logger</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">log_msg_id</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">log_file_suffix</span><span class="o">=</span><span class="s2">&quot;.log&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a customized logger for SKiDL.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a logger with handlers for outputting to both</span>
<span class="sd">    the console and a log file, with proper formatting for SKiDL messages.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        title (str): Name/title for the logger.</span>
<span class="sd">        log_msg_id (str, optional): Prefix for log messages.</span>
<span class="sd">        log_file_suffix (str, optional): Suffix for the log filename.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">        SkidlLogger: Configured logger instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">setLoggerClass</span><span class="p">(</span><span class="n">SkidlLogger</span><span class="p">)</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Prevent the logger from propagating messages up to the root logger</span>
    <span class="c1"># so that messages are only sent to the handlers attached to this logger.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Errors &amp; warnings always appear on the terminal.</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">log_msg_id</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># Errors and warnings are stored in a log file with the top-level script&#39;s name.</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">SkidlLogFileHandler</span><span class="p">(</span><span class="n">get_script_name</span><span class="p">()</span> <span class="o">+</span> <span class="n">log_file_suffix</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
    <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="n">log_msg_id</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2">: </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

    <span class="c1"># Set logger to trigger on info, warning, and error messages.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="c1"># Augment the logger&#39;s functions to count the number of errors and warnings.</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">CountCalls</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="n">CountCalls</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">bare_error</span> <span class="o">=</span> <span class="n">CountCalls</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">bare_error</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">bare_warning</span> <span class="o">=</span> <span class="n">CountCalls</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">bare_warning</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">logger</span>


<div class="viewcode-block" id="stop_log_file_output">
<a class="viewcode-back" href="../../rst_output/skidl.logger.html#skidl.logger.stop_log_file_output">[docs]</a>
<span class="nd">@export_to_all</span>
<span class="k">def</span> <span class="nf">stop_log_file_output</span><span class="p">(</span><span class="n">stop</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stop or restart log file output for all loggers.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        stop (bool, optional): True to stop file output, False to allow it.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stop</span><span class="p">:</span>
        <span class="n">rt_logger</span><span class="o">.</span><span class="n">stop_file_output</span><span class="p">()</span>
        <span class="n">erc_logger</span><span class="o">.</span><span class="n">stop_file_output</span><span class="p">()</span></div>



<span class="c1">###############################################################################</span>

<span class="c1"># Create loggers for runtime messages and ERC reports.</span>
<span class="n">rt_logger</span> <span class="o">=</span> <span class="n">_create_logger</span><span class="p">(</span><span class="s2">&quot;skidl&quot;</span><span class="p">)</span>
<span class="n">rt_logger</span><span class="o">.</span><span class="n">set_trace_depth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">erc_logger</span> <span class="o">=</span> <span class="n">_create_logger</span><span class="p">(</span><span class="s2">&quot;ERC_Logger&quot;</span><span class="p">,</span> <span class="s2">&quot;ERC &quot;</span><span class="p">,</span> <span class="s2">&quot;.erc&quot;</span><span class="p">)</span>
<span class="n">erc_logger</span><span class="o">.</span><span class="n">set_trace_depth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create active logger that starts off as the runtime logger.</span>
<span class="n">active_logger</span> <span class="o">=</span> <span class="n">ActiveLogger</span><span class="p">(</span><span class="n">rt_logger</span><span class="p">)</span>

<span class="c1">###############################################################################</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SKiDL 2.1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">skidl.logger</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2016-2025, Dave Vandenbout.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>